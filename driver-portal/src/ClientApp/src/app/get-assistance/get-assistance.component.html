<div class="container">
  <div class="list">
    <h2>Get Assistance</h2>
    <div class="assistance-page">
      <div>
        <p>
          To get answers to your questions, you can look through our Help Topics
          below. If you need further help, you can ask for a call back from a
          customer service representative at RSBC. There is a maximum of 1 open
          call back request at anytime. This is the best way to get support
          quickly. You can also contact RSBC by phone if you prefer.
        </p>
      </div>
      <div>
        <div class="callBackContent">
          <div class="text">
            You have 1 open Request Call Back *
            <ul>
              <li>
                <a href="#" (click)="viewRequest($event, 'callBack')">
                  View Request
                </a>
              </li>
            </ul>
            <span>* Maximum of 1 open call back request</span>
          </div>
        </div>
      </div>
    </div>
    <div style="padding-top: 32px">
      <h2>Help Topics</h2>
      <div class="help">
        <div class="help-topics" cdkMenu>
          <button
            class="help-topics-item"
            (click)="recommendedTopics()"
            cdkMenuItem
          >
            <b>Recommended topics</b>
          </button>
          <button class="help-topics-item" cdkMenuItem>
            <b> Help with Driver Portal </b>
          </button>
          <button class="help-topics-item" cdkMenuItem>
            <b> About my current case </b>
          </button>
          <button class="help-topics-item" cdkMenuItem>
            <b>Documents </b>
          </button>
          <button class="help-topics-item" cdkMenuItem>
            <b>Letters to Driver</b>
          </button>
        </div>
        @if (display === 0) {

        <div class="help-cards">
          <mat-card (click)="helpcard()">
            <mat-card-content
              ><b> Upload a Document </b>
              <div>
                You have an extra document that you want to submit to RSBC.
                <br />
                Learn more about this process.
              </div>
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content
              ><b> View DMER submission </b>
              <div>
                DMERs submitted online by a medical practitioner will not be
                visible to you. Learn how you can obtain a copy.
              </div>
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content
              ><b> Received an incorrect letter </b>
              <div>
                If you have received a letter from RSBC which does not relate to
                you find out how to report this to RSBC.
              </div>
            </mat-card-content>
          </mat-card>
        </div>
        <div class="help-cards">
          <mat-card>
            <mat-card-content
              ><b> Cannot see document in Document History </b>
              <div>
                In certain instances you will not immediately see your document
                requirement appear in Document History.
              </div>
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content
              ><b>Submit a replacement document </b>
              <div>
                Uploading an incorrect file can happen. Learn how you can
                resubmit a document.
              </div>
            </mat-card-content>
          </mat-card>
          <mat-card>
            <mat-card-content
              ><b> Request extension </b>
              <div>
                Sometimes life gets in the way. Learn how you can request an
                extension from RSBC on your case.
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        } @else if (display === 5) {
        <div>
          <b style="padding: 12px">Upload an Extra Document</b>
          <p>
            Under the Submission Requirements tab on a case page, RSBC lists all
            the submissions they require from you. If RSBC has not asked for a
            specific document, they probably do not require it at this time.
          </p>
          <p>The Driver Portal does not allow you to upload extra documents.</p>
          <p>
            To submit an extra document you need to discuss this with a RSBC
            agent by requesting a call back. They will be able to provide you
            with the assistance you need.
          </p>
          <div class="callback">
            <div style="display: flex; gap: 42px; padding: 24px">
              <b>Still require assistance?</b>
              <button (click)="onRequestCallBack()">Request Call Back</button>
              <button (click)="viewRequest($event, 'callBack')">
                Contact RSBC
              </button>
            </div>
          </div>
          <div style="padding: 24px" *ngIf="showCallBack">
            <h3>Request Call Back</h3>
            <form>
              <div style="display: flex; flex-direction: column">
                <div>
                  <mat-form-field style="width: 300px">
                    <mat-label>Select Topic</mat-label>
                    <mat-select
                      [(ngModel)]="selectedValue"
                      name="callBackTopic"
                    >
                      @for (callBackTopic of callBackTopics; track
                      callBackTopic) {
                      <mat-option [value]="callBackTopic.value">{{
                        callBackTopic.viewValue
                      }}</mat-option>
                      }
                    </mat-select>
                  </mat-form-field>
                </div>
                <div>
                  <label class="form-label">Phone Number</label>
                  <mat-form-field appearance="outline" class="inputWidth">
                    <input
                      matInput
                      name="phoneNumber"
                      placeholder="Phone Number"
                    />
                  </mat-form-field>
                </div>
                <div>
                  <label class="form-label">Best time to receive a call</label>
                  <label> <input type="checkbox" />9:00am - 5:00pm </label>
                  <label> <input type="checkbox" />9:00am and 12:00pm </label>
                  <label> <input type="checkbox" />12:01am - 5:00pm </label>
                </div>
              </div>
              <div class="submitButtonContainer">
                <button
                  mat-flat-button
                  class="primaryButton"
                  (click)="createCallBack()"
                >
                  Submit
                </button>
                <button class="cancelButton" (click)="back()">Back</button>
              </div>
            </form>
          </div>
        </div>

        }
      </div>
    </div>
    <div style="padding-top: 32px">
      <h2>Contact RoadSafetyBC</h2>
      <p>
        If the topics above don't give you the answer you're looking for, you
        can call a client service representative at RSBC. <br />
        <br />
        <b>Hours of operation</b>: Monday to Friday from 8am to 5pm <br />

        <b>Phone</b>: 1-855-387-7747
      </p>
    </div>
    <div style="padding-top: 32px" id="callBack">
      <h2>Request Call Back History</h2>
      <p>
        Once you've asked for a call back, you will find a record of your
        request in this table. You can check the status of your request and see
        any notes added by RSBC customer service representatives. If you no
        longer need assistance, you have the option to cancel your open request
        whenever you want.
      </p>
      <div style="padding-bottom: 32px">
        <mat-card
          *ngFor="let callback of allCallBacks"
          [ngClass]="{
            open: callback.id && isExpanded[callback.id]
          }"
        >
          <mat-card-content class="closedCaseContent">
            <div style="text-align: center">
              <mat-icon
                (click)="toggleIsExpandable(callback.id)"
                class="expandedIcon"
              >
                expand_circle_down
              </mat-icon>
            </div>
            <div style="display: flex; flex-direction: column">
              <div class="case-details-border">&nbsp;</div>
              <div>&nbsp;</div>
            </div>
            <div style="flex: 1">
              <div class="caseDetailRow">
                <div>
                  <label>Request call back date </label>
                  <div>
                    <b>{{ callback.requestCallback | date : "longDate" }}</b>
                  </div>
                </div>

                <div>
                  <label>Topic</label>
                  <div>
                    <b>{{ callback.topic }}</b>
                  </div>
                </div>
                <div>
                  <label>Call Status</label>
                  <div>
                    <b>{{ callback.callStatus }}</b>
                  </div>
                </div>
                <div>
                  <label></label>
                  <div>
                    <button
                      mat-flat-button
                      (click)="openCancelCallbackDialog(callback)"
                    >
                      Cancel Callback
                    </button>
                  </div>
                </div>
              </div>

              <div
                class="caseDetailRow"
                *ngIf="callback.id && isExpanded?.[callback.id]"
                style="
                  border-top: 2px solid gray;
                  padding-top: 20px;
                  padding-bottom: 20px;
                "
              >
                <div>
                  <label>Preferred callback times</label>
                  <div>
                    <!-- <b>{{ letter.caseId }}</b> -->
                    <b>9:00am and 12:00pm</b>
                  </div>
                </div>
                <div>
                  <label>RSBC Call details</label>
                  <div>
                    <!-- <b>{{ letter.caseId }}</b> -->
                    <b>April 29 - Call attempt unsuccessful</b>
                  </div>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <div
      class="numberOfItems"
      *ngIf="
        allCallBacks &&
        allCallBacks.length > 0 &&
        filteredCallbacks &&
        filteredCallbacks.length > 0
      "
    >
      Showing {{ filteredCallbacks.length }} of
      {{ allCallBacks.length }} records
      <br />
      <a
        *ngIf="filteredCallbacks.length < allCallBacks.length"
        (click)="viewMore()"
        class="viewMore"
        ><b style="color: #003366">View more records</b>
        <mat-icon class="ViewMoreIcon">expand_circle_down</mat-icon></a
      >
    </div>
  </div>
</div>
