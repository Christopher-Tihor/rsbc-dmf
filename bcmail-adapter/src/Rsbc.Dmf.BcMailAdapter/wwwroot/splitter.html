<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>
    <h1>Document Splitter</h1>
    <div id="PageCheckboxes">

    </div>
    <hr />
    <div id="SelectedPages">
        <b>Selected Pages:</b>
        <ul id="SelectedPagesList">
            
        </ul>
    </div>
    <br>
    <button onclick="splitPdf()"> Split Document </button>
    <button onclick="cancelpdf()"> Cancel</button>




</body>

<script type="text/javascript">

    const baseUrl = "https://localhost:5015/Documents"

    const documentId = "58907ab6-f65b-ee11-b846-00505683fbf4";

    const splitUrl = `${baseUrl}/${documentId}/Split`;
    const pageCountUrl = `${baseUrl}/${documentId}/GetPageCount`;

    const pageCheckboxesElem = document.getElementById("PageCheckboxes");

    const PageSelectorCheckboxClassName = 'page-selector-checkbox';
    const DataPageAttribute = 'data-page';

    // Get Page count and create checkboxes based on page count
    function getPageCount() {
       
        fetch(pageCountUrl).then(response => response.json()).then(pageCount => {
            console.log(pageCount);
            const pageCountInt = parseInt(pageCount);
            // loop page count times and create checkboxes
            for (let i = 0; i < pageCountInt; i++) {
                // console.log("Count:", i);
                const divElem = document.createElement('div');

                const labelElem = document.createElement('label');
                labelElem.innerHTML = `Page ${i + 1}`;
                const checkboxElem = document.createElement('input');

                checkboxElem.setAttribute('type', 'checkbox');
                checkboxElem.setAttribute('name', `page${i + 1}`);
                checkboxElem.setAttribute(DataPageAttribute, i + 1);
                // add class name
                checkboxElem.classList.add(PageSelectorCheckboxClassName);

                divElem.appendChild(checkboxElem);  

                divElem.appendChild(labelElem);
                pageCheckboxesElem.appendChild(divElem);
            } 
        });
    }

    getPageCount();

    // Split pdf button Click
    function splitPdf() {
        console.log("Test Split PDF button Click");
        const checkboxes = document.getElementsByClassName(PageSelectorCheckboxClassName);
        // console.log(checkboxes);

        const checked = Array.from(checkboxes).filter((elm) => elm.checked);

        const selectedPages = checked.map((c) => c.getAttribute('data-page'));
        console.log("Selected Pages:", selectedPages);
        const ul = document.getElementById('SelectedPagesList');
        ul.innerHTML = '';
        selectedPages.forEach((num) => {
            const li = document.createElement('li');
            li.innerHTML = num;

            ul.appendChild(li);    
        })

        //fetch(splitUrl).then(response => response.json()).then(response => console.log(response));
    }

    // cancel button click
    function cancelpdf() {

    }


   
</script>
</html>


